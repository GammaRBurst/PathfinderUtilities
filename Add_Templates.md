# Database Structure for *templates.js*

If you are interested in adding your templates to the database, here is how you can write them in.

__Warning__: The values may change in future updates. I like to have everything in order, usually alphabetical based on the property's name, the numerical values should mirror that order, so whenever I add/move/remove some values (particularly subtypes and groups) I shift all the numbers appropriately. This means that a custom template may need to be redefined after an update. Refer to the [manual to add creatures](Add_Creatures.md) to check if the values changed.

The database is organized as a CSV (comma-separated values) file, with the first and last line to transform everything into a javascript variable. There are 4 values, separated by a semicolon (;). The semicolon can't be used for anything else. If the number of fields is different from 4, the entry is discarded by the software.

If not indicated differently, every field is mandatory. An empty field looks like this: ;; (between the two semicolons).

Empty lines, or lines containing only spaces and tabulations, as well as lines beginning with # are ignored. You can separate your content with as many empty lines as you wish and add comments with # to better identify everything. Spaces around values are ignored, so you don't need to, say, add a space after every semicolon. It's not much, but it helps keep the database lighter.

Don't edit in any way the first and last lines of the database. Insert everything after the first line and before the last. If you don't, the software will generate an error and stop working.

You can edit *templates.js* with any text editor. I would advise against programs that manage CSV files such as Microsoft Excel because this is not a perfect CSV file. If you do anyway, remember that the program will add 4 semicolons to each empty line and comment. You'll have to remove them with a text editor anyway.

## Fields

1. __Name__: This name will be shown in the *Variants* column of the table. It can be composed of any sequence of letters, numbers, symbols and spaces, excluded ; and the following reserved characters:
    * *~* is used for alternative link names. There doesn't seem to be a standard in the naming of templates. Some of them contain the word *creature*, while others don't. (e.g. *fungoid creature* vs. *young*) This can be used to have more uniformity in the names. (e.g. *young creature~young*)
        * The first letter after each space, open parenthesis and dash in a creature's name is automatically capitalized for the link generation, but that's not always how the page is named on AoN. If the link requires some special capitalization, use _~*_ instead.
        * If the creature's sheet is not available on AoN, but can be found elsewhere, you can write the whole sheet's URL after *~*.
        * If the creature's sheet is not available anywhere on the web, you can force the creature to have no link by adding *~* followed by nothing else.
    * Sometimes the apostrophe in a name has to be replaced with *%u2019* in the link. There's no rule for that, just check if it's a straight vertical apostrophe (no change needed) or if it's rounded.
1. __Conditions__: A list of conditions a creature must fulfill in order to be qualified for the template. Conditions are separated by *&*, indicating that all conditions must be met. This is the only field that can be left empty. This means that no condition is required.
    * Conditions compare the value of a creature field with one or more numerical values. Comparing two creature fields is not possible.
        * A creature field is indicated with a *$* followed by a number. *$1* is the __Name__ field, *$2* the __CR__ field and so on. Refer to the [creature database instructions](Add_Creatures.md) to find the correct number of a field.
        * The possible comparisons are *equal* (*=*), *different* (*!*), *bigger than* (*>*) and *smaller than* (*<*). Signs like >= and <= are not valid. If you want a quantity to be *at least 5*, that is *>=5*, write instead *>4*. All values in the database are whole numbers, so the two operations are equivalent. To indicate that a field must be constrained betwen two values, write two different conditions, one for the lower and one for the upper bound.
        * *<* and *>* accept a single whole number as a comparison. *=* and *!* can confront with a list of comma-separated numbers and also numerical intervals, indicated by two numbers separated by a dash. (e.g. *3-7*)
    * The syntax is then: __creature field__ *compared to* __numerical value(s)__. E.g. *$6!1,3,7-10,13* indicates that the creature's type (*$6*) can't be (*!*) Aberration (*1*), Construct (*3*), Magical Beast, Monstrous Humanoid, Ooze, Outsider (*7-10*), Vermin (*13*).
    * It's also possible to declare conditional conditions. The syntax is *if_condition?then_condition:else_condition*. The *then_condition* is checked if the *if_condition* is true, otherwise the *else_condition* is checked. The *if_condition* and *then_condition* must be simple conditions, as described above (field compared to numerical values), the *else_condition* can also be another conditional condition. In this way it's possible to construct a *else if* condition. E.g. *$9<4?$14>6:$9<7?$14>7:$14>8* checks the value of Intelligence (*$14*) based on the number of HD (*$9*). If the creature has less than 4 HD (*$9<4*) it must have at least Intelligence 7 (*$14>6*). Otherwise if the number of HD is less than 7 (and implicitly at least 4, or the first condition would have triggered), it must have at least Intelligence 8 (*$14>7*). Finally, if the number of HD is at least 7, the Intelligence score must be at least 9 (*$14>8*).
    * All conditions have to be satisfied. If you instead need to satisfy one of two conditions, you can use the conditional notation in this way: *condition1?condition1:condition2*. This means that if *condition1* is true, it's checked again (yes, it's a bit redundant...) and the condition is accepted, while if it's false, *condition2* is checked instead.
    * The conditions given by the templates in the manuals are usually not much specific. Some common sense is necessary to avoid absurd combinations. Since programming common sense into this software was too much for my skills, it's a good idea to apply more restrictions than the ones listed in the manuals. Some common implicit restrictions are on alignment, types (which types are excluded depends a lot on the template), subtypes (many templates shouldn't be applied to incorporeal creatures), Intelligence score (*$14>2* is the most common) and plane (usually *$19=1* is a good idea).
1. __Category__: A single number indicating the kind of template.
    1. *Physical modification templates* are templates that change the body of a creature. Up to 3 of these templates can be applied together to a creature.
    1. *Planar templates* are templates that transform a creature of the Material Plane into an inhabitant of another plane. Only one of these templates can be applied to a creature.
    1. *Class templates* are templates that confer some of the abilities given by the core classes. These are the ones that can give the most absurd results. Only one of these templates can be applied to a creature.
1. __Rebuild Rules__: A list of changes applied to the creature. Not all the rules listed in the manuals are inserted into this list, only those that change the value of an existing field. E.g. changes in AC or additional attacks have not to be added. The syntax is very similar to the one for the conditions.
    * Rules are always separated by *&*.
    * To indicate which field to edit, use *$* followed by the field number and then by *~*. This last character is the *assign value* operator.
    * A direct assignment is represented by one or more numbers separated by a comma, or a simple text, no quotes needed. (e.g. *$6~12* changes the creature's type to Undead) It's also possible to assign a field to another field.
    * An addition is represented by a field plus a number, or vice versa. It's not possible to sum two numbers or two fields. It can either be an actual addition, in the case of fields that usually have single numbers, such as CR or ability scores (e.g. *$11~$11+4* increases Strength by 4) or it can add one or more numbers or strings separated by commas to a list (e.g. *$7~$7+7,10* adds the Fire and Evil subtypes and leaves all the others). Intervals are not allowed.
    * A subtraction is represented by a field minus a number, or vice versa. It can either be an actual subtraction, in the case of fields that usually have single numbers, such as CR or ability scores (e.g. *$2~$2-1* reduces CR by 1) or it can remove one or more numbers or strings separated by commas from a list (e.g. *$7~$7-42* removes the Giant subtype, if present, and leaves all the others). Intervals are not allowed.
    * A string substitution is a text that contains one (and only one) *$* sign, followed by a number. This is usually used to change the name of a creature. (e.g. *$1~advanced $1* adds *advanced* before the creature's name) The template's name won't be added to the link.
    * Conditional assignments are also possible. The syntax is *if_condition?then_assignment:else_assignment*. If the *if_condition* is true, then the *then_assignment* is applied, otherwise the *else_assignment* is. E.g. *$2~$9>4?$2+1:$2* means that if the number of HD is at least 5 (*$9>4*) CR increases by 1 (*$2+1*), otherwise it doesn't change (*$1*). The assign operation *~* is always __outside__ the conditional assignment. To be clear, this is __wrong__ and won't work: *$9>4?$2~$2+1:$2~$2*. The *else_assignment* must always be specified, even if there is no change. Again, this is __wrong__: *$2~$9>4?$2+1*.
    * Fields can operate only with similar fields. Numbers with numbers, strings with strings, lists with lists. These examples won't work: *$1~advanced $2* (CR is a number, while the name is a string), *$11~$6* (Strength is a number, while Type is a list of numbers).
